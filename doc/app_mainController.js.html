<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: app/mainController.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: app/mainController.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module mainController
 */
app.controller("mainController", function($rootScope, $scope, $state, $http, $uibModal, $timeout, userProject, userNotification){

    $scope.loggedIn = false;
    $scope.showIDE = true;
    $scope.showAll = false;

    /* User data */
    $scope.firstname = '';
    $scope.lastname = '';
    $scope.email = '';

    $scope.sidebarTabs = {
        soundbrowser: false,
        scriptbrowser: false,
        apibrowser: false
    };

    // Loading ogg by default for browsers other than Safari
    if (whichBrowser().match('Opera|Chrome|Firefox|Msie|Trident') !== null) {
        $scope.audioQuality = true;//false wav, true ogg
    } else {
        $scope.audioQuality = false;//false wav, true ogg
    }

    getURLParameters();

    $scope.init = function() {
        esconsole('initialing main controller 1 ...', ['debug', 'init']);
        EarSketch.analytics.init(); // start tracking, set gaID

        $scope.loaded = true;
        $scope.updateSoundQualityGlyph($scope.audioQuality);
        setTimeout(function () {
            if (!userProject.isLogged()) {
                userProject.fillCustomSounds();
            }
        }, 1000);
    };

    $scope.downloadSpinnerClick = function() {
        console.log('***** downloadSpinnerClick **********');
        document.getElementById('download-loader').style.display='none';
    }

    $scope.soundQuality = function(arg) {
        esconsole('Arg is ' + arg, 'debug');
        if((arg == 1) &amp;&amp; (whichBrowser().match('Safari') !== null || whichBrowser().match('Edge') !== null)) {
            esconsole('Safari does not support low bandwidth audio decoder, continuing with WAV',['WARNING','MAIN']);
            $scope.audioQuality = false;
        }
        else {
            $scope.audioQuality = arg;
        }
        $scope.updateSoundQualityGlyph($scope.audioQuality);


    }
    $scope.updateSoundQualityGlyph = function(arg) {
        if (whichBrowser().match('Safari') !== null || whichBrowser().match('Edge') !== null) {
            $("#bw i").removeClass("glyphicon glyphicon-ok").addClass("glyphicon glyphicon-ok-sign");
        }
        else {
            if ($scope.audioQuality == true){
                $("#bw i").removeClass("glyphicon glyphicon-ok-sign").addClass("glyphicon glyphicon-unchecked");
            }
            else {
                $("#bw i").removeClass("glyphicon glyphicon-unchecked").addClass("glyphicon glyphicon-ok-sign");
            }
        }
        if (!$scope.audioQuality)
            esconsole('Loading wav', ['debug', 'init']);
        else
            esconsole('Loading ogg', ['debug', 'init']);
    }

    $scope.setPage = function (page){
        if(page == "workstation"){
            $scope.$broadcast('workstation', {});
            EarSketch.analytics.logButtonClickEvent("viewWorkstation");
            $scope.handleCombinedViewStyling(false);
            $scope.showIDE = false;
            $scope.showAll = false;
        }
        else if(page == "development"){
            $scope.$broadcast('development', {});
            EarSketch.analytics.logButtonClickEvent("viewCodeEditor");
            $scope.handleCombinedViewStyling(false);
            $scope.showIDE = true;
            $scope.showAll = false;
        }
        else if(page == 'all') {
            $scope.$broadcast('workstation', {});
            $scope.$broadcast('development', {});
            EarSketch.analytics.logButtonClickEvent("viewAll");
            $scope.handleCombinedViewStyling(true);
            $scope.showAll = true;
        }
    };

    $scope.projects =  [{"id":"470","name":"powerhouse"},{"id":"547","name":"flynn's proj 02"}];
    //$scope.scripts = [{"created": "2014-03-03 22:13:03.0","file_location": "","id": "837","modified": "2014-03-03 22:13:03.0","name": "newscripta.py","source_code": "xxx","username": "esaccount"}];
    $scope.scripts = [];

    // these should be populated from somewhere else and not hard-coded, most likely
    $scope.languages = [{'lang': 'Python'}, {'lang': 'JavaScript'}];
    $scope.fontSizes = [{'size': 'Default'},{'size': 10},{'size': 12},{'size': 14},{'size': 18},
                        {'size': 24},{'size': 36}];

    $scope.login = function () {
        EarSketch.analytics.logButtonClickEvent("login");
        userProject.fillProjects($scope, $scope.username , $scope.password);
    };

    $scope.logout = function () {
      EarSketch.analytics.logButtonClickEvent("logout");

      // clear out all the values set at login
      $scope.scripts = [];
      $scope.username = '';
      $scope.password = '';
      $scope.loggedIn = false;
      userProject.resetProject();

      //remove sourcecode cookie
      docCookies.removeItem("sourceCode");
      docCookies.removeItem("language");
    };

    $scope.showLoginSuccess = function() {
        $scope.loggedIn = true;
        $scope.$apply();
        userNotification.show('Login successful.');
    };

    $scope.showLoginFailure = function () {
        userNotification.show('Your username or password is incorrect. Please try logging in again or register a new account.', 'failure1',  3.5);
    };

    $scope.createAccount = function(){
        var modalInstance = $uibModal.open({
            templateUrl: 'templates/create-account.html',
            controller: 'accountController',
            scope: $scope
        });
    }

    $scope.forgotPass = function(){
        var modalInstance = $uibModal.open({
            templateUrl: 'templates/forgot-password.html',
            controller: 'forgotpasswordController'
        });
    }

    $scope.changePassword = function(){
        var modalInstance = $uibModal.open({
            templateUrl: 'templates/change-password.html',
            controller: 'changepasswordController',
            scope: $scope
        });
    }

    $scope.handleCombinedViewStyling = function(combined) {
      if(combined) {
        // set width of main view to full width of window
        $('.tab-content').width($( window ).width());
        $('.tab-content').addClass('combined-view');
        $('#devctrl').addClass('combined-view');
        $('.workstation').addClass('combined-view');
        $('.loading').addClass('combined-view');
        $('.license').addClass('combined-view');
      } else {
        $('.tab-content').css('width', '');
        $('.tab-content').removeClass('combined-view');
        $('#devctrl').removeClass('combined-view');
        $('.workstation').removeClass('combined-view');
        $('.loading').removeClass('combined-view');
        $('.license').removeClass('combined-view');
      }
    }

    var  loadState = function (){
        esconsole('*************loading state ...', ['debug', 'init']);
        var jsstate = localStorage.getItem('userstate');
        if(jsstate!=null){
            esconsole('Load state is obsolete?', ['WARNING', 'MAIN'])
            var userState = JSON.parse(jsstate);
            userProject.fillProjects($scope, userState.username, userState.password);
            // simply allows username to continue be displayed after reload
            $scope.username = userState.username;

        }

    }

    loadState();

    $scope.$watch(function() {
        return $scope.sidebarTabs;
    }, function() {
        // open and close the sidebar when sidebar tabs are toggled

        var open = false;
        angular.forEach($scope.sidebarTabs, function(value, key) {
            if (value) {
                open = true;
            }
        });

        if (typeof myLayout !== 'undefined') {
            // open sidebar if it is closed
            if (open &amp;&amp; myLayout.west.state.isClosed) {
                myLayout.open('west');
            // close sidebar if it is open
            } else if (!open &amp;&amp; !myLayout.west.state.isClosed) {
                myLayout.close('west');
            }
        }
    }, true);

    $scope.closeSidebarTabs = function() {
        angular.forEach($scope.sidebarTabs, function(value, key) {
            $scope.sidebarTabs[key] = false;
        });
    }

    $scope.openSidebarTab = function(tab) {
        $timeout(function(){
            $scope.closeSidebarTabs();
            $scope.sidebarTabs[tab] = true;
        });

    }

    $scope.toggleSidebarTab = function(tab) {
        if ($scope.sidebarTabs[tab]) {
            $scope.closeSidebarTabs();
        } else {
            $scope.openSidebarTab(tab);
        }
    }

});

/*
app.directive('uidevelopment', function() {
  return {
    restrict: 'E',
    templateUrl: 'templates/development.html',
    replace: true,
    scope: false,
    controller: 'ideController'
  };
});

app.directive('uiworkstation', function() {
  return {
    restrict: 'E',
    templateUrl: 'templates/workstation.html',
    replace: true,
    scope: false,
    controller: 'dawController'
  };
});*/
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-accountController.html">accountController</a></li><li><a href="module-Analyze.html">Analyze</a></li><li><a href="module-apibrowserController.html">apibrowserController</a></li><li><a href="module-audioContext.html">audioContext</a></li><li><a href="module-audioeffects.html">audioeffects</a></li><li><a href="module-audioLibrary.html">audioLibrary</a></li><li><a href="module-autograderController.html">autograderController</a></li><li><a href="module-buildAudioNodeGraph.html">buildAudioNodeGraph</a></li><li><a href="module-changepasswordController.html">changepasswordController</a></li><li><a href="module-ColorPickerCtrl.html">ColorPickerCtrl</a></li><li><a href="module-compiler.html">compiler</a></li><li><a href="module-dawClip.html">dawClip</a></li><li><a href="module-dawClipName.html">dawClipName</a></li><li><a href="module-dawContainerController.html">dawContainerController</a></li><li><a href="module-dawController.html">dawController</a></li><li><a href="module-dawEffect.html">dawEffect</a></li><li><a href="module-dawTimeline.html">dawTimeline</a></li><li><a href="module-dawTrackController.html">dawTrackController</a></li><li><a href="module-DownloadFileCtrl.html">DownloadFileCtrl</a></li><li><a href="module-EarSketchApp.html">EarSketchApp</a></li><li><a href="module-forgotpasswordController.html">forgotpasswordController</a></li><li><a href="module-ideController.html">ideController</a></li><li><a href="module-JavascriptAPI.html">JavascriptAPI</a></li><li><a href="module-mainController.html">mainController</a></li><li><a href="module-NativeJavascriptAPI.html">NativeJavascriptAPI</a></li><li><a href="module-Passthrough.html">Passthrough</a></li><li><a href="module-pitchshifter.html">pitchshifter</a></li><li><a href="module-player.html">player</a></li><li><a href="module-PythonAPI.html">PythonAPI</a></li><li><a href="module-renameController.html">renameController</a></li><li><a href="module-renderer.html">renderer</a></li><li><a href="module-ReportErrorCtrl.html">ReportErrorCtrl</a></li><li><a href="module-SaveScriptCtrl.html">SaveScriptCtrl</a></li><li><a href="module-uploader.html">uploader</a></li><li><a href="module-userConsole.html">userConsole</a></li><li><a href="module-userNotification.html">userNotification</a></li><li><a href="module-WaveforrmCache.html">WaveforrmCache</a></li></ul><h3>Global</h3><ul><li><a href="global.html#addESTagToLog">addESTagToLog</a></li><li><a href="global.html#addESTagToNotLog">addESTagToNotLog</a></li><li><a href="global.html#addESTagToNotPrint">addESTagToNotPrint</a></li><li><a href="global.html#addESTagToPrint">addESTagToPrint</a></li><li><a href="global.html#esconsole">esconsole</a></li><li><a href="global.html#ESLog">ESLog</a></li><li><a href="global.html#formatResultForTests">formatResultForTests</a></li><li><a href="global.html#formatScriptForTests">formatScriptForTests</a></li><li><a href="global.html#getURLParameters">getURLParameters</a></li><li><a href="global.html#ServiceWrapper">ServiceWrapper</a></li><li><a href="global.html#setESConsoleTraceLevel">setESConsoleTraceLevel</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.3.3</a> on Thu Feb 11 2016 16:06:08 GMT-0500 (EST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
